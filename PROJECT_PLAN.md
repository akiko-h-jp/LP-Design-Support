# 開発進行表

## 概要

LPデザイン支援ツールの開発を段階的に進めます。各フェーズで動作確認を行いながら、次のフェーズに進みます。

---

## Phase 1: プロジェクト基盤構築

### 目標
開発環境とプロジェクト構造を準備し、基本的な設定を整える

### 実施内容

#### 1.1 プロジェクトディレクトリ構造の作成
- Next.jsアプリケーションとして構築
- 機能ごとにファイルを分けた構成を作成
- 以下のディレクトリ構造を構築：
  ```
  nextjs-app/
    app/                # Next.js App Router
      api/              # API Routes
      page.tsx          # クライアント入力フォーム
      designer/         # デザイナー用画面
      interview/        # ヒアリング整理画面
      copy/             # LPコピー生成画面
      design-instruction/ # デザイン指示生成画面
      login/            # ログイン画面
    lib/
      handlers/         # ビジネスロジック
      services/         # API連携サービス
      utils/            # ユーティリティ
    components/         # 再利用可能なUIコンポーネント
    types/              # TypeScript型定義
  ```

#### 1.2 環境変数設定ファイルの作成
- `.env.local` テンプレートファイルを作成
- 必要な環境変数の定義：
  - `GEMINI_API_KEY`
  - `GOOGLE_DRIVE_CREDENTIALS_PATH`
  - `GOOGLE_DRIVE_TOKEN_PATH`
  - `GOOGLE_DRIVE_FOLDER_ID`
  - `NEXTAUTH_SECRET`
  - `NEXTAUTH_URL`
  - `ADMIN_EMAIL`
  - `ADMIN_PASSWORD_HASH`

#### 1.3 依存パッケージの定義
- `package.json` を作成
- 必要なNode.jsパッケージを定義：
  - `next`（Next.jsフレームワーク）
  - `react`、`react-dom`（React）
  - `@google/generative-ai`（Gemini API）
  - `googleapis`（Google Drive API）
  - `next-auth`（認証）
  - `bcryptjs`（パスワードハッシュ）
  - `uuid`（ID生成）
  - その他必要なパッケージ

#### 1.4 Next.jsプロジェクトの初期化
- Next.js 16を使用
- TypeScript設定
- Tailwind CSS設定
- App Routerを使用した構成

#### 1.5 基本的なエラーハンドリングとログ設定
- 共通エラーハンドリングの実装
- API Routesでのエラーハンドリング

### 成果物
- ✅ Next.jsプロジェクト構造
- ✅ `.env.local` テンプレートファイル
- ✅ `package.json` ファイル
- ✅ TypeScript設定
- ✅ Tailwind CSS設定
- ✅ 基本的なエラーハンドリング

### 確認事項
- プロジェクト構造が機能ごとに分かれているか
- 環境変数が正しく読み込めるか
- 設定値の検証が動作するか

---

## Phase 2: Google Drive API連携（データ保存基盤）

### 目標
データ保存機能の基盤を構築し、Google Driveにデータを保存・読み込みできるようにする

### 実施内容

#### 2.1 Google Drive API認証設定
- Google Cloud Consoleでの認証情報取得
- OAuth2認証フローの実装
- トークンの保存・読み込み機能

#### 2.2 Google Driveサービスモジュールの実装
- `lib/services/googleDriveService.ts` を実装
- **フォルダ作成機能**
  - 案件単位でフォルダを作成
  - フォルダ名の命名規則
- **ファイル作成機能**
  - Google Docsファイルの作成
  - Google Sheetsファイルの作成
- **ファイル読み込み機能**
  - 既存ファイルの読み込み
  - ファイル内容の取得

#### 2.3 データ保存ハンドラーの実装
- `lib/handlers/dataStorageHandler.ts` を実装
- **保存機能**
  - クライアント事前入力内容の保存
  - デザイナー整理後ヒアリング内容の保存
  - 協議メモの保存
  - LPコピー確定稿の保存
  - デザイン指示データの保存
- **読み込み機能**
  - 案件データの読み込み
  - 各データタイプの取得

#### 2.4 テスト用の保存・読み込み機能の動作確認
- テストデータでの保存テスト
- 保存したデータの読み込みテスト
- エラーハンドリングの確認

### 成果物
- ✅ Google Drive API連携機能
- ✅ データ保存・読み込み機能
- ✅ 案件単位のフォルダ管理機能

### 確認事項
- Google Driveへの認証が正常に動作するか
- フォルダ・ファイルの作成ができるか
- データの保存・読み込みが正常に動作するか

---

## Phase 3: クライアント事前ヒアリング機能

### 目標
クライアントが事前に入力できる機能を実装する

### 実施内容

#### 3.1 クライアント入力フォーム設計
- 入力項目の確定
  - 企業名・サービス名
  - 業種・業界
  - ターゲット顧客
  - 提供価値・特徴
  - 競合情報
  - その他基本情報
- 入力フォームの構造設計

#### 3.2 クライアント入力ハンドラーの実装
- `lib/handlers/clientInputHandler.ts` を実装
- 案件番号管理機能の実装（`lib/utils/projectNumberManager.ts`）
- **入力受付機能**
  - フォームデータの受信
  - 入力データの一時保存
- **入力データ管理機能**
  - 入力データの取得
  - 入力データの更新

#### 3.3 入力データのバリデーション
- `lib/utils/validation.ts` にバリデーション関数を実装
- 必須項目のチェック
- データ形式の検証
- エラーメッセージの生成

#### 3.4 デザイナー側での入力内容確認機能
- 入力内容の表示機能
- 入力内容の編集機能（後工程での編集を想定）

#### 3.5 UI実装（Phase 3完了後）
- **クライアント入力フォーム**（`app/page.tsx`）の実装
  - ログイン不要のURL共有を想定
  - 8セクションの入力フォーム
    - 基本情報
    - ターゲット情報
    - 提供価値・ベネフィット
    - 実績・社会証明（任意）
    - 競合情報（任意）
    - ブランド情報（任意）
    - LPの目的・ゴール
  - バリデーション機能（必須項目チェック）
  - 送信機能（API Routes連携）
  - デザイナー用ログインページへのリンク
- **デザイナー用確認画面**（`app/designer/page.tsx`）の実装
  - プロジェクト一覧表示（案件番号表示対応）
  - 入力内容詳細表示・編集
  - Google Driveへの保存機能
  - ログアウト機能

### 成果物
- ✅ クライアント事前入力受付機能
- ✅ 入力データバリデーション機能
- ✅ 入力データ確認・編集機能
- ✅ 案件番号管理機能（YYYY-XXX形式）
- ✅ クライアント入力フォーム（Next.js）
- ✅ デザイナー用確認画面（Next.js）

### 確認事項
- クライアントが入力データを送信できるか
- 入力データが正しく保存されるか
- デザイナーが入力内容を確認・編集できるか
- UIとバックエンドAPIが正しく連携するか

---

## Phase 4: Gemini API連携とヒアリング整理機能

### 目標
AIを活用したヒアリング整理・編集支援機能を実装する

### 実施内容

#### 4.1 Gemini API認証設定
- Gemini APIキーの設定確認
- API接続テスト

#### 4.2 Geminiサービスモジュールの実装
- `lib/services/geminiService.ts` を実装
- **基本機能**
  - テキスト生成機能
  - プロンプト設定機能
  - エラーハンドリング

#### 4.3 ヒアリング整理ハンドラーの実装
- `lib/handlers/interviewManagementHandler.ts` を実装
- **情報分析機能**
  - 情報の不足・曖昧・矛盾の指摘
  - 構造化された分析結果の出力
- **追加質問生成機能**
  - AIによる追加ヒアリング質問の提示
  - 質問の優先度付け
- **内容の構造化支援機能**
  - ヒアリング内容の整理
  - 構造化されたデータ形式への変換

#### 4.4 デザイナー編集機能の実装
- ヒアリング内容の編集機能
- AI分析結果の確認・承認機能
- 追加質問への回答機能

#### 4.5 ヒアリング内容の確定機能
- 確定データの保存
- 次工程へのデータ引き渡し

#### 4.6 UI実装（Phase 4完了後）
- **デザイナー用ヒアリング整理画面**（`app/interview/page.tsx`）の実装
  - クライアント入力内容の表示
  - AI分析結果の表示（不足・曖昧・矛盾の指摘）
  - 追加質問の表示
  - ヒアリング内容の編集機能
  - 保存機能（アプリ内保存）
  - 確定機能（アプリ内保存 + Google Drive保存）

### 成果物
- ✅ Gemini API連携機能（Gemini 2.5 Flash使用）
- ✅ AI支援によるヒアリング整理機能
- ✅ デザイナー編集・確定機能
- ✅ デザイナー用ヒアリング整理画面（Next.js）

### 確認事項
- Gemini APIが正常に動作するか
- AI分析が適切に機能するか
- デザイナーが編集・確定できるか
- UIとバックエンドAPIが正しく連携するか

---

## Phase 5: 仮LPコピー生成機能

### 目標
確定したヒアリング内容から仮LPコピーを生成する

### 実施内容

#### 5.1 コピー生成ハンドラーの実装
- `lib/handlers/copyGenerationHandler.ts` を実装
- ヒアリングデータの受け取り
- コピー生成の実行

#### 5.2 Gemini APIを使用したコピー生成ロジック
- **プロンプト設計**
  - 誇張・断定表現を避ける指示
  - 実績・数値は与えられた場合のみ使用
  - 完成稿ではないことを明示
- **セクション別コピー生成**
  - Hero（Headline / Sub / Support）
  - Problem
  - Solution
  - Benefits（3項目）
  - Social Proof
  - CTA（Primary / Secondary）
- **編集メモ生成**
  - 調整提案の生成
  - 改善点の指摘

#### 5.3 コピー出力フォーマットの実装
- 構造化されたコピーデータの形式定義
- JSON形式での出力
- セクション別のデータ構造

#### 5.4 生成コピーの保存機能
- 仮コピーの一時保存
- 次工程へのデータ引き渡し

#### 5.5 UI実装（Phase 5完了後）
- **コピー生成・表示画面**（`app/copy/page.tsx`）の実装
  - ヒアリング内容の確認
  - コピー生成ボタン
  - 生成されたコピーの表示（セクション別）
  - 編集メモの表示
  - 編集機能（編集する/保存/確定ボタン）
  - 保存機能（アプリ内保存）
  - 確定機能（アプリ内保存 + Google Drive保存）

### 成果物
- ✅ 仮LPコピー生成機能
- ✅ 編集前提のコピー出力
- ✅ 構造化されたコピーデータ
- ✅ コピー生成・表示画面（Next.js）

### 確認事項
- コピーが適切に生成されるか
- 誇張表現が避けられているか
- セクションが正しく生成されるか
- UIとバックエンドAPIが正しく連携するか

---

## Phase 6: コピー編集・確定機能

### 目標
生成されたコピーを編集・確定する機能を実装する

### 実施内容

#### 6.1 コピー編集ハンドラーの実装
- コピー編集機能はPhase 5のUI実装に含まれる
- 生成コピーの読み込み
- 編集データの保存

#### 6.2 セクション別編集機能
- 各セクション（Hero、Problem、Solution等）の個別編集
- リアルタイムプレビュー機能
- 編集履歴の管理

#### 6.3 コピー確定機能
- 確定データの検証
- 確定データの保存
- 次工程へのデータ引き渡し

#### 6.4 確定コピーの保存機能
- Google Driveへの保存（既存プロジェクトフォルダに保存）
- 確定稿の記録
- JSON形式と人間が読みやすい形式の両方で保存

### 成果物
- ✅ コピー編集機能（Phase 5のUIに統合）
- ✅ コピー確定機能
- ✅ 確定コピーの保存機能（既存フォルダに保存）
- ✅ デュアルフォーマット保存（JSON + 読みやすい形式）

### 確認事項
- セクション別に編集できるか
- 確定データが正しく保存されるか
- 次工程にデータが引き渡せるか
- UIとバックエンドAPIが正しく連携するか

---

## Phase 7: デザイン指示生成機能

### 目標
確定コピーからデザイン指示を生成する

### 実施内容

#### 7.1 デザイン指示生成ハンドラーの実装
- `lib/handlers/designInstructionHandler.ts` を実装
- 確定コピーの読み込み
- デザイン指示の生成実行

#### 7.2 Gemini APIを使用したデザイン指示生成
- **プロンプト設計**
  - セクション別の設計意図
- **出力内容の生成**
  - デザインコンセプト
  - トーン
  - レイアウト方針
  - セクション別設計意図・メモ

#### 7.3 デザイン指示のフォーマット設計
- 構造化された指示データの形式定義
- JSON形式での出力

#### 7.4 デザイン指示の保存機能
- Google Driveへの保存（既存プロジェクトフォルダに保存）
- JSON形式と人間が読みやすい形式の両方で保存

#### 7.5 UI実装（Phase 7完了後）
- **デザイン指示表示画面**（`app/design-instruction/page.tsx`）の実装
  - 確定コピーの確認
  - デザイン指示生成ボタン
  - 生成されたデザイン指示の表示
    - デザインコンセプト
    - トーン
    - レイアウト方針
    - セクション別設計意図・メモ
  - 編集機能（編集する/保存/確定ボタン）
  - 保存機能（アプリ内保存）
  - 確定機能（アプリ内保存 + Google Drive保存）

### 成果物
- ✅ デザイン指示生成機能
- ✅ 構造化されたデザイン指示データ
- ✅ デザイン指示の保存機能（既存フォルダに保存）
- ✅ デザイン指示表示画面（Next.js）
- ✅ デュアルフォーマット保存（JSON + 読みやすい形式）

### 確認事項
- デザイン指示が適切に生成されるか
- データが正しく保存されるか
- UIとバックエンドAPIが正しく連携するか

---

## Phase 8: ログイン機能とセキュリティ強化

### 目標
デザイナー用機能へのアクセス制御を実装する

### 実施内容

#### 8.1 認証システムの実装
- NextAuth.js v5を使用した認証機能
- メールアドレスとパスワードによるログイン
- セッション管理

#### 8.2 ログインページの実装
- `app/login/page.tsx` の実装
- ログインフォーム
- エラーハンドリング

#### 8.3 認証保護機能
- デザイナー用ページの認証保護
- 未認証ユーザーのリダイレクト

#### 8.4 パスワード管理
- bcryptjsによるパスワードハッシュ化
- 環境変数による安全な管理

### 成果物
- ✅ ログイン機能
- ✅ 認証保護機能
- ✅ ログインページ（Next.js）
- ✅ ログアウト機能

### 確認事項
- ログインが正常に動作するか
- 認証保護が機能するか
- セッション管理が適切か

---

## Phase 9: 統合テストとエラーハンドリング強化

### 目標
全機能の統合とエラー対応の強化を行う

### 実施内容

#### 9.1 全機能の統合テスト
- エンドツーエンドのテスト
- 各フェーズ間のデータ連携確認
- 実際のワークフローでの動作確認

#### 9.2 エラーハンドリングの強化
- **入力情報不足時の対応**
  - 不足項目の明確な指摘
  - 追加入力の促し
- **AI生成失敗時の再実行機能**
  - 手動再実行機能
- **保存失敗時の手動保存・再実行機能**
  - エラー時のデータ保持
  - 手動保存機能
  - 再実行機能

#### 9.3 UI/UXの改善
- エラーメッセージの改善
- ユーザーフィードバックの改善
- 操作性の向上

#### 9.4 ドキュメント整備
- API仕様書の作成
- 使用方法のドキュメント
- トラブルシューティングガイド

### 成果物
- ✅ 統合されたシステム
- ✅ 強化されたエラーハンドリング
- ✅ 運用ドキュメント

### 確認事項
- 全機能が正常に連携するか
- エラー時の対応が適切か
- ドキュメントが整備されているか

---

## 全体スケジュール概要

| Phase | 内容 | 推定工数 | 依存関係 |
|-------|------|---------|---------|
| Phase 1 | プロジェクト基盤構築（Next.js移行） | 完了 | - |
| Phase 2 | Google Drive API連携 | 完了 | Phase 1 |
| Phase 3 | クライアント事前ヒアリング | 完了 | Phase 2 |
| Phase 4 | Gemini API連携とヒアリング整理 | 完了 | Phase 2, Phase 3 |
| Phase 5 | 仮LPコピー生成 | 完了 | Phase 4 |
| Phase 6 | コピー編集・確定 | 完了 | Phase 5 |
| Phase 7 | デザイン指示生成 | 完了 | Phase 6 |
| Phase 8 | ログイン機能とセキュリティ強化 | 完了 | - |
| Phase 9 | 統合テストとエラーハンドリング | 完了 | Phase 8 |

---

## 開発方針

1. **段階的実装**: 各フェーズで動作確認を行いながら進める
2. **機能の独立性**: 各機能モジュールは独立して動作可能に設計
3. **拡張性**: 将来的な機能追加を妨げない設計
4. **エラー対応**: 各フェーズでエラーハンドリングを実装
5. **ドキュメント**: 各機能の実装時にドキュメントを整備

---

## UI実装について

UIはNext.jsのApp Routerを使用して直接実装しました。

### UI実装の基本方針
- **Next.js App Routerを使用**: 各ページを`app/`ディレクトリに配置
- **段階的なUI実装**: 機能ごとにUIを作成し、動作確認を行いながら進める
- **再利用可能なコンポーネント**: `components/`ディレクトリに共通コンポーネントを配置

### 実装したUI

| Phase | 実装したUI | ファイルパス |
|-------|-----------|------------|
| Phase 3 | クライアント入力フォーム | `app/page.tsx` |
| Phase 3 | デザイナー用確認画面 | `app/designer/page.tsx` |
| Phase 4 | デザイナー用ヒアリング整理画面 | `app/interview/page.tsx` |
| Phase 5 | LPコピー生成・表示画面 | `app/copy/page.tsx` |
| Phase 7 | デザイン指示表示画面 | `app/design-instruction/page.tsx` |
| Phase 8 | ログインページ | `app/login/page.tsx` |

### 共通コンポーネント
- `components/FormSection.tsx` - フォームセクション
- `components/InputField.tsx` - テキスト入力フィールド
- `components/TextareaField.tsx` - テキストエリアフィールド
- `components/SelectField.tsx` - セレクトフィールド

---

## 次のステップ

Phase 1から順番に実装を開始します。各フェーズ完了時に動作確認を行い、問題がなければ次のフェーズに進みます。

